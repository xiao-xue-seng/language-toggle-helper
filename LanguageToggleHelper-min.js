/*
  祈請大寶恩師加持
 */
"use strict";const toggleAttributeName="data-toggle-lang",langs=[{id:"bo",label:"藏文"},{id:"zh",label:"中文"},{id:"classical",label:"古文"},{id:"modern",label:"白話"}];function ensureValue(e,t=!0){return null!=e?e:t}export class SwitchConfig{constructor(e={}){langs.forEach((t=>{this[t.id]=ensureValue(e[t.id])}))}}function creatDataItem(e="",t=!0,a=!1,n="",l=function(e){}){const r=e;let g=t;const i=l;return{get lang(){return r},get enabled(){return g},set enabled(e){g!==e&&(g=e,i(this))},available:a,get label(){return n}}}export default function LanguageToggleHelper(e=new SwitchConfig){let t=!1;const a=langs.map((({id:t,label:a})=>creatDataItem(t,e[t],!1,a,i)));let n=[];const l=[],r=Object.fromEntries(a.map((({lang:e})=>[e,new RegExp(`data-toggle-lang\\s*=\\s*['"]?${e}`)])));function g(){n=a.filter((e=>e.available)),l.forEach((e=>e(n)))}function i(e){if(!t||!e.available)return;const a=`[data-toggle-lang="${e.lang}"]`,n=e.enabled;t.querySelectorAll(a).forEach((e=>{e.hidden=!n}))}return{get dataList(){return a},get contextElement(){return t},set contextElement(e){this.bindContextElement(e)},bindContextElement(e){return e instanceof HTMLElement?e!==t&&(t=e):t=!1,this},reset(){return a.forEach((t=>{t.enabled=e[t.lang],t.available=!1})),g(),this},get availableLanguages(){return n},updateAvailabilityByHtml(e){return a.forEach((t=>{const a=r[t.lang]&&r[t.lang].test(e);t.available=ensureValue(a,!1)})),g(),this},updateAvailabilityByElement(){if(!t)return this;const e=t.querySelectorAll("[data-toggle-lang]");if(e.length>0){const t=Array.from(e);a.forEach((e=>{e.available=t.some((t=>t.getAttribute("data-toggle-lang")===e.lang))}))}return g(),this},applyLanguageToggles(){if(n.length<1)return this;const e=n.reduce(((e,t)=>(e[t.lang]=t.enabled,e)),{});return t.querySelectorAll("[data-toggle-lang]").forEach((t=>{const a=t.getAttribute("data-toggle-lang");t.hidden=!ensureValue(e[a])})),this},onAvailableLanguagesChange(e){"function"==typeof e&&l.push(e)},offAvailableLanguagesChange(e){const t=l.indexOf(e);-1!==t&&l.splice(t,1)}}}